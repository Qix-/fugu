<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>fg: export_obj_point3d.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="fg.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">fg&#160;<span id="projectnumber">0.1</span></div>
   <div id="projectbrief">Form Generation Made Easy</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">export_obj_point3d.h</div>  </div>
</div>
<div class="contents">
<a href="export__obj__point3d_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00004"></a>00004 <span class="comment">/****************************************************************************</span>
<a name="l00005"></a>00005 <span class="comment">* VCGLib                                                            o o     *</span>
<a name="l00006"></a>00006 <span class="comment">* Visual and Computer Graphics Library                            o     o   *</span>
<a name="l00007"></a>00007 <span class="comment">*                                                                _   O  _   *</span>
<a name="l00008"></a>00008 <span class="comment">* Copyright(C) 2004                                                \/)\/    *</span>
<a name="l00009"></a>00009 <span class="comment">* Visual Computing Lab                                            /\/|      *</span>
<a name="l00010"></a>00010 <span class="comment">* ISTI - Italian National Research Council                           |      *</span>
<a name="l00011"></a>00011 <span class="comment">*                                                                    \      *</span>
<a name="l00012"></a>00012 <span class="comment">* All rights reserved.                                                      *</span>
<a name="l00013"></a>00013 <span class="comment">*                                                                           *</span>
<a name="l00014"></a>00014 <span class="comment">* This program is free software; you can redistribute it and/or modify      *</span>
<a name="l00015"></a>00015 <span class="comment">* it under the terms of the GNU General Public License as published by      *</span>
<a name="l00016"></a>00016 <span class="comment">* the Free Software Foundation; either version 2 of the License, or         *</span>
<a name="l00017"></a>00017 <span class="comment">* (at your option) any later version.                                       *</span>
<a name="l00018"></a>00018 <span class="comment">*                                                                           *</span>
<a name="l00019"></a>00019 <span class="comment">* This program is distributed in the hope that it will be useful,           *</span>
<a name="l00020"></a>00020 <span class="comment">* but WITHOUT ANY WARRANTY; without even the implied warranty of            *</span>
<a name="l00021"></a>00021 <span class="comment">* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the             *</span>
<a name="l00022"></a>00022 <span class="comment">* GNU General Public License (http://www.gnu.org/licenses/gpl.txt)          *</span>
<a name="l00023"></a>00023 <span class="comment">* for more details.                                                         *</span>
<a name="l00024"></a>00024 <span class="comment">*                                                                           *</span>
<a name="l00025"></a>00025 <span class="comment">****************************************************************************/</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#ifndef __VCGLIB_EXPORT_OBJ_POINT3D</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#define __VCGLIB_EXPORT_OBJ_POINT3D</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;wrap/callback.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;wrap/io_trimesh/io_mask.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;wrap/io_trimesh/io_material.h&gt;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="namespacevcg.html">00038</a> <span class="keyword">namespace </span>vcg {
<a name="l00039"></a><a class="code" href="namespacevcg_1_1tri.html">00039</a> <span class="keyword">namespace </span>tri {
<a name="l00040"></a><a class="code" href="namespacevcg_1_1tri_1_1io.html">00040</a> <span class="keyword">namespace </span>io {
<a name="l00041"></a>00041 
<a name="l00042"></a>00042     <span class="keyword">template</span> &lt;<span class="keyword">class</span> SaveMeshType&gt;
<a name="l00043"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html">00043</a>     <span class="keyword">class </span><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html">ExporterOBJ_Point3d</a>
<a name="l00044"></a>00044     {
<a name="l00045"></a>00045     <span class="keyword">public</span>:
<a name="l00046"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a0ef9d246c2955ab6befbb6b69d82e11c">00046</a>         <span class="keyword">typedef</span> <span class="keyword">typename</span> SaveMeshType::FaceIterator <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a0ef9d246c2955ab6befbb6b69d82e11c">FaceIterator</a>;
<a name="l00047"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#ab633ad3e3e2615f5564f54d06d56febd">00047</a>         <span class="keyword">typedef</span> <span class="keyword">typename</span> SaveMeshType::VertexIterator <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#ab633ad3e3e2615f5564f54d06d56febd">VertexIterator</a>;
<a name="l00048"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a4264198f2d1ae395a3d5f8a71839a69a">00048</a>         <span class="keyword">typedef</span> <span class="keyword">typename</span> SaveMeshType::VertexType <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a4264198f2d1ae395a3d5f8a71839a69a">VertexType</a>;
<a name="l00049"></a>00049 
<a name="l00050"></a>00050         <span class="comment">/*</span>
<a name="l00051"></a>00051 <span class="comment">            enum of all the types of error</span>
<a name="l00052"></a>00052 <span class="comment">        */</span>
<a name="l00053"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001f">00053</a>         <span class="keyword">enum</span> <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001f">SaveError</a>
<a name="l00054"></a>00054         {
<a name="l00055"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fa6a1b7d8fde2edc6d0bb520f1f3a855e0">00055</a>             <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fa6a1b7d8fde2edc6d0bb520f1f3a855e0">E_NOERROR</a>,                  <span class="comment">// 0</span>
<a name="l00056"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001faec6da76495ec2922ed8e9d1dd890df5b">00056</a>             <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001faec6da76495ec2922ed8e9d1dd890df5b">E_CANTOPENFILE</a>,             <span class="comment">// 1</span>
<a name="l00057"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fa8fd42777d69764d7abc0725f4c66940e">00057</a>             <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fa8fd42777d69764d7abc0725f4c66940e">E_CANTCLOSEFILE</a>,            <span class="comment">// 2</span>
<a name="l00058"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fadeb5555d4c6f8f870f2a84a2b764f09f">00058</a>             <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fadeb5555d4c6f8f870f2a84a2b764f09f">E_UNESPECTEDEOF</a>,            <span class="comment">// 3</span>
<a name="l00059"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fa0d6f0738ecd6056275f2deef0ede5b31">00059</a>             <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fa0d6f0738ecd6056275f2deef0ede5b31">E_ABORTED</a>,                  <span class="comment">// 4</span>
<a name="l00060"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fa22feb3ab3db4a9b21e0ce41670739f5f">00060</a>             <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fa22feb3ab3db4a9b21e0ce41670739f5f">E_NOTDEFINITION</a>,            <span class="comment">// 5</span>
<a name="l00061"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fad3a6e173b43260b2144ea7dd3986a7f3">00061</a>             <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fad3a6e173b43260b2144ea7dd3986a7f3">E_NOTVEXTEXVALID</a>,           <span class="comment">// 6</span>
<a name="l00062"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fab78ba3ba95f78a518b78e5a7329ee071">00062</a>             <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fab78ba3ba95f78a518b78e5a7329ee071">E_NOTFACESVALID</a>             <span class="comment">// 7</span>
<a name="l00063"></a>00063         };
<a name="l00064"></a>00064 
<a name="l00065"></a>00065         <span class="comment">/*</span>
<a name="l00066"></a>00066 <span class="comment">            this function takes an index and the relative error message gets back</span>
<a name="l00067"></a>00067 <span class="comment">        */</span>
<a name="l00068"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a222df6a1aa4be7ca6f4b95b710f146c8">00068</a>         <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a222df6a1aa4be7ca6f4b95b710f146c8">ErrorMsg</a>(<span class="keywordtype">int</span> <a class="code" href="namespacefg.html#abde9d5a413e985fc2f63ad2e45e80cc2">error</a>)
<a name="l00069"></a>00069         {
<a name="l00070"></a>00070             <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* obj_error_msg[] =
<a name="l00071"></a>00071             {
<a name="l00072"></a>00072                     <span class="stringliteral">&quot;No errors&quot;</span>,                            <span class="comment">// 0</span>
<a name="l00073"></a>00073                     <span class="stringliteral">&quot;Can&#39;t open file&quot;</span>,                      <span class="comment">// 1</span>
<a name="l00074"></a>00074                     <span class="stringliteral">&quot;can&#39;t close file&quot;</span>,                     <span class="comment">// 2</span>
<a name="l00075"></a>00075                     <span class="stringliteral">&quot;Premature End of file&quot;</span>,                <span class="comment">// 3</span>
<a name="l00076"></a>00076                     <span class="stringliteral">&quot;File saving aborted&quot;</span>,                  <span class="comment">// 4</span>
<a name="l00077"></a>00077                     <span class="stringliteral">&quot;Function not defined&quot;</span>,                 <span class="comment">// 5</span>
<a name="l00078"></a>00078                     <span class="stringliteral">&quot;Vertices not valid&quot;</span>,                   <span class="comment">// 6</span>
<a name="l00079"></a>00079                     <span class="stringliteral">&quot;Faces not valid&quot;</span>                       <span class="comment">// 7</span>
<a name="l00080"></a>00080                 };
<a name="l00081"></a>00081 
<a name="l00082"></a>00082             <span class="keywordflow">if</span>(error&gt;7 || error&lt;0) <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown error&quot;</span>;
<a name="l00083"></a>00083             <span class="keywordflow">else</span> <span class="keywordflow">return</span> obj_error_msg[<a class="code" href="namespacefg.html#abde9d5a413e985fc2f63ad2e45e80cc2">error</a>];
<a name="l00084"></a>00084         };
<a name="l00085"></a>00085 
<a name="l00086"></a>00086         <span class="comment">/*</span>
<a name="l00087"></a>00087 <span class="comment">            returns mask of capability one define with what are the saveable information of the format.</span>
<a name="l00088"></a>00088 <span class="comment">        */</span>
<a name="l00089"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#ab6c3e98f29ffba7b35e5dd00d872cee6">00089</a>         <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#ab6c3e98f29ffba7b35e5dd00d872cee6">GetExportMaskCapability</a>()
<a name="l00090"></a>00090         {
<a name="l00091"></a>00091             <span class="keywordtype">int</span> capability = 0;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093             <span class="comment">//vert</span>
<a name="l00094"></a>00094             capability |= vcg::tri::io::Mask::IOM_VERTNORMAL;
<a name="l00095"></a>00095       capability |= vcg::tri::io::Mask::IOM_VERTTEXCOORD;
<a name="l00096"></a>00096             capability |= vcg::tri::io::Mask::IOM_VERTCOLOR;
<a name="l00097"></a>00097 
<a name="l00098"></a>00098             <span class="comment">//face</span>
<a name="l00099"></a>00099             capability |= vcg::tri::io::Mask::IOM_FACECOLOR;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101             <span class="comment">//wedg</span>
<a name="l00102"></a>00102             capability |= vcg::tri::io::Mask::IOM_WEDGTEXCOORD;
<a name="l00103"></a>00103             capability |= vcg::tri::io::Mask::IOM_WEDGNORMAL;
<a name="l00104"></a>00104 
<a name="l00105"></a>00105             <span class="keywordflow">return</span> capability;
<a name="l00106"></a>00106         }
<a name="l00107"></a>00107 
<a name="l00108"></a>00108         <span class="comment">/*</span>
<a name="l00109"></a>00109 <span class="comment">            function which saves in OBJ file format</span>
<a name="l00110"></a>00110 <span class="comment">        */</span>
<a name="l00111"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#aebe4d1a8d08a8bf83dc9fc7145d6cb2d">00111</a>         <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#aebe4d1a8d08a8bf83dc9fc7145d6cb2d">Save</a>(SaveMeshType &amp;m, <span class="keyword">const</span> <span class="keywordtype">char</span> * filename, <span class="keywordtype">int</span> mask, CallBackPos *cb=0)
<a name="l00112"></a>00112         {
<a name="l00113"></a>00113       <span class="comment">// texture coord and normal: cannot be saved BOTH per vertex and per wedge</span>
<a name="l00114"></a>00114       <span class="keywordflow">if</span> (mask &amp; vcg::tri::io::Mask::IOM_WEDGTEXCOORD &amp;&amp;
<a name="l00115"></a>00115           mask &amp; vcg::tri::io::Mask::IOM_VERTTEXCOORD ) {
<a name="l00116"></a>00116         mask &amp;= ~vcg::tri::io::Mask::IOM_VERTTEXCOORD;
<a name="l00117"></a>00117       }
<a name="l00118"></a>00118       <span class="keywordflow">if</span> (mask &amp; vcg::tri::io::Mask::IOM_WEDGCOLOR &amp;&amp;
<a name="l00119"></a>00119           mask &amp; vcg::tri::io::Mask::IOM_VERTCOLOR ) {
<a name="l00120"></a>00120         mask &amp;= ~vcg::tri::io::Mask::IOM_VERTCOLOR;
<a name="l00121"></a>00121       }
<a name="l00122"></a>00122       <span class="keywordflow">if</span>(m.vn == 0) <span class="keywordflow">return</span> <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fad3a6e173b43260b2144ea7dd3986a7f3">E_NOTVEXTEXVALID</a>;
<a name="l00123"></a>00123             <span class="comment">// Commented out this control. You should be allowed to save a point cloud.</span>
<a name="l00124"></a>00124             <span class="comment">// if(m.fn == 0)    return E_NOTFACESVALID;</span>
<a name="l00125"></a>00125 
<a name="l00126"></a>00126             <span class="keywordtype">int</span> current = 0;
<a name="l00127"></a>00127             <span class="keywordtype">int</span> totalPrimitives = m.vn+m.fn;
<a name="l00128"></a>00128 
<a name="l00129"></a>00129             std::vector&lt;Material&gt; materialVec;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131             std::string fn(filename);
<a name="l00132"></a>00132             <span class="keywordtype">int</span> LastSlash=fn.size()-1;
<a name="l00133"></a>00133             <span class="keywordflow">while</span>(LastSlash&gt;=0 &amp;&amp; fn[LastSlash]!=<span class="charliteral">&#39;/&#39;</span>)
<a name="l00134"></a>00134         --LastSlash;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136             FILE *fp;
<a name="l00137"></a>00137             fp = fopen(filename,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00138"></a>00138             <span class="keywordflow">if</span>(fp == NULL) <span class="keywordflow">return</span> <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001faec6da76495ec2922ed8e9d1dd890df5b">E_CANTOPENFILE</a>;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140             fprintf(fp,<span class="stringliteral">&quot;####\n#\n# OBJ File Generated by Meshlab\n#\n####\n&quot;</span>);
<a name="l00141"></a>00141             fprintf(fp,<span class="stringliteral">&quot;# Object %s\n#\n# Vertices: %d\n# Faces: %d\n#\n####\n&quot;</span>,fn.substr(LastSlash+1).c_str(),m.vn,m.fn);
<a name="l00142"></a>00142 
<a name="l00143"></a>00143             <span class="comment">//library materialVec</span>
<a name="l00144"></a>00144             <span class="keywordflow">if</span>( (mask &amp; vcg::tri::io::Mask::IOM_FACECOLOR)  || (mask &amp; Mask::IOM_WEDGTEXCOORD) )
<a name="l00145"></a>00145                 fprintf(fp,<span class="stringliteral">&quot;mtllib ./%s.mtl\n\n&quot;</span>,fn.substr(LastSlash+1).c_str());
<a name="l00146"></a>00146 
<a name="l00147"></a>00147             <span class="comment">//vertexs + normal</span>
<a name="l00148"></a>00148             <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#ab633ad3e3e2615f5564f54d06d56febd">VertexIterator</a> vi;
<a name="l00149"></a>00149             std::map&lt;Point3d,int&gt; NormalVertex;
<a name="l00150"></a>00150       std::vector&lt;int&gt; VertexId(m.vert.size());
<a name="l00151"></a>00151             <span class="keywordtype">int</span> numvert = 0;
<a name="l00152"></a>00152             <span class="keywordtype">int</span> curNormalIndex = 1;
<a name="l00153"></a>00153             <span class="keywordflow">for</span>(vi=m.vert.begin(); vi!=m.vert.end(); ++vi) <span class="keywordflow">if</span>( !(*vi).IsD() )
<a name="l00154"></a>00154             {
<a name="l00155"></a>00155         VertexId[vi-m.vert.begin()]=numvert;
<a name="l00156"></a>00156                 <span class="comment">//saves normal per vertex</span>
<a name="l00157"></a>00157         <span class="keywordflow">if</span> (mask &amp; Mask::IOM_WEDGNORMAL )
<a name="l00158"></a>00158                 {
<a name="l00159"></a>00159                     <span class="keywordflow">if</span>(<a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a221ab806617b6eee77ecd69ec4b0ab75">AddNewNormalVertex</a>(NormalVertex,(*vi).N(),curNormalIndex))
<a name="l00160"></a>00160                     {
<a name="l00161"></a>00161                         fprintf(fp,<span class="stringliteral">&quot;vn %f %f %f\n&quot;</span>,(*vi).N()[0],(*vi).N()[1],(*vi).N()[2]);
<a name="l00162"></a>00162                         curNormalIndex++;
<a name="l00163"></a>00163                     }
<a name="l00164"></a>00164                 }
<a name="l00165"></a>00165         <span class="keywordflow">if</span> (mask &amp; Mask::IOM_VERTNORMAL ) {
<a name="l00166"></a>00166           fprintf(fp,<span class="stringliteral">&quot;vn %f %f %f\n&quot;</span>,(*vi).N()[0],(*vi).N()[1],(*vi).N()[2]);
<a name="l00167"></a>00167         }
<a name="l00168"></a>00168         <span class="keywordflow">if</span> (mask &amp; Mask::IOM_VERTTEXCOORD ) {
<a name="l00169"></a>00169           fprintf(fp,<span class="stringliteral">&quot;vt %f %f\n&quot;</span>,(*vi).T().P()[0],(*vi).T().P()[1]);
<a name="l00170"></a>00170         }
<a name="l00171"></a>00171         <span class="comment">//if (mask &amp; Mask::IOM_VERTCOLOR ) {</span>
<a name="l00172"></a>00172         <span class="comment">//  fprintf(fp,&quot;vc %f %f %f\n&quot;,(*vi).T().P()[0],(*vi).T().P()[1]);</span>
<a name="l00173"></a>00173         <span class="comment">//}</span>
<a name="l00174"></a>00174 
<a name="l00175"></a>00175                 <span class="comment">//saves vertex</span>
<a name="l00176"></a>00176 
<a name="l00177"></a>00177                 fprintf(fp,<span class="stringliteral">&quot;v %f %f %f&quot;</span>,(*vi).P()[0],(*vi).P()[1],(*vi).P()[2]);
<a name="l00178"></a>00178                 <span class="keywordflow">if</span>(mask &amp; Mask::IOM_VERTCOLOR)
<a name="l00179"></a>00179                     fprintf(fp,<span class="stringliteral">&quot; %f %f %f&quot;</span>,<span class="keywordtype">double</span>((*vi).C()[0])/255.,<span class="keywordtype">double</span>((*vi).C()[1])/255.,<span class="keywordtype">double</span>((*vi).C()[2])/255.);
<a name="l00180"></a>00180                 fprintf(fp,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00181"></a>00181 
<a name="l00182"></a>00182                 <span class="keywordflow">if</span> (cb !=NULL)
<a name="l00183"></a>00183                 {
<a name="l00184"></a>00184                     <span class="keywordflow">if</span>(!(*cb)((100*++current)/totalPrimitives, <span class="stringliteral">&quot;writing vertices &quot;</span>))
<a name="l00185"></a>00185                     {
<a name="l00186"></a>00186                         fclose(fp);
<a name="l00187"></a>00187                         <span class="keywordflow">return</span> <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fa0d6f0738ecd6056275f2deef0ede5b31">E_ABORTED</a>;
<a name="l00188"></a>00188                     }
<a name="l00189"></a>00189                 }
<a name="l00190"></a>00190         numvert++;
<a name="l00191"></a>00191             }
<a name="l00192"></a>00192       assert(numvert == m.vn);
<a name="l00193"></a>00193 
<a name="l00194"></a>00194             fprintf(fp,<span class="stringliteral">&quot;# %d vertices, %d vertices normals\n\n&quot;</span>,m.vn,<span class="keywordtype">int</span>(NormalVertex.size()));
<a name="l00195"></a>00195 
<a name="l00196"></a>00196             <span class="comment">//faces + texture coords</span>
<a name="l00197"></a>00197             <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a0ef9d246c2955ab6befbb6b69d82e11c">FaceIterator</a> fi;
<a name="l00198"></a>00198             std::map&lt;vcg::TexCoord2&lt;float&gt;,<span class="keywordtype">int</span>&gt; CoordIndexTexture;
<a name="l00199"></a>00199             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> material_num = 0;
<a name="l00200"></a>00200             <span class="keywordtype">int</span> mem_index = 0; <span class="comment">//var temporany</span>
<a name="l00201"></a>00201             <span class="keywordtype">int</span> curTexCoordIndex = 1;
<a name="l00202"></a>00202             <span class="keywordflow">for</span>(fi=m.face.begin(); fi!=m.face.end(); ++fi) <span class="keywordflow">if</span>( !(*fi).IsD() )
<a name="l00203"></a>00203             {
<a name="l00204"></a>00204                 <span class="keywordflow">if</span>((mask &amp; Mask::IOM_FACECOLOR) || (mask &amp; Mask::IOM_WEDGTEXCOORD) )
<a name="l00205"></a>00205                 {
<a name="l00206"></a>00206                     <span class="keywordtype">int</span> index = Materials&lt;SaveMeshType&gt;::CreateNewMaterial(m,materialVec,material_num,fi);
<a name="l00207"></a>00207 
<a name="l00208"></a>00208                     <span class="keywordflow">if</span>(index == (<span class="keywordtype">int</span>)materialVec.size())<span class="comment">//inserts a new element material</span>
<a name="l00209"></a>00209                     {
<a name="l00210"></a>00210                         material_num++;
<a name="l00211"></a>00211                         fprintf(fp,<span class="stringliteral">&quot;\nusemtl material_%d\n&quot;</span>,materialVec[index-1].index);
<a name="l00212"></a>00212                         mem_index = index-1;
<a name="l00213"></a>00213                     }
<a name="l00214"></a>00214                     <span class="keywordflow">else</span>
<a name="l00215"></a>00215                     {
<a name="l00216"></a>00216                         <span class="keywordflow">if</span>(index != mem_index)<span class="comment">//inserts old name elemente material</span>
<a name="l00217"></a>00217                         {
<a name="l00218"></a>00218                             fprintf(fp,<span class="stringliteral">&quot;\nusemtl material_%d\n&quot;</span>,materialVec[index].index);
<a name="l00219"></a>00219                             mem_index=index;
<a name="l00220"></a>00220                         }
<a name="l00221"></a>00221                     }
<a name="l00222"></a>00222                 }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224         <span class="comment">//saves texture coord x wedge</span>
<a name="l00225"></a>00225         <span class="keywordflow">if</span>(HasPerWedgeTexCoord(m) &amp;&amp; (mask &amp; Mask::IOM_WEDGTEXCOORD))
<a name="l00226"></a>00226         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0;k&lt;(*fi).VN();k++)
<a name="l00227"></a>00227                 {
<a name="l00228"></a>00228                     {
<a name="l00229"></a>00229                         <span class="keywordflow">if</span>(<a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a2cd44837c6811ae1540718d484aabbfa">AddNewTextureCoord</a>(CoordIndexTexture,(*fi).WT(k),curTexCoordIndex))
<a name="l00230"></a>00230                         {
<a name="l00231"></a>00231                             fprintf(fp,<span class="stringliteral">&quot;vt %f %f\n&quot;</span>,(*fi).WT(k).u(),(*fi).WT(k).v());
<a name="l00232"></a>00232                             curTexCoordIndex++; <span class="comment">//ncreases the value number to be associated to the Texture</span>
<a name="l00233"></a>00233                         }
<a name="l00234"></a>00234                     }
<a name="l00235"></a>00235                 }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237 
<a name="l00238"></a>00238                 fprintf(fp,<span class="stringliteral">&quot;f &quot;</span>);
<a name="l00239"></a>00239         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0;k&lt;(*fi).VN();k++)
<a name="l00240"></a>00240                 {
<a name="l00241"></a>00241                 <span class="keywordflow">if</span>(k!=0) fprintf(fp,<span class="stringliteral">&quot; &quot;</span>);
<a name="l00242"></a>00242                     <span class="keywordtype">int</span> vInd = -1;
<a name="l00243"></a>00243                     <span class="comment">// +1 because Obj file format begins from index = 1 but not from index = 0.</span>
<a name="l00244"></a>00244                     vInd = VertexId[<a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#ac744bf0192152d2bc55724601c975ebb">GetIndexVertex</a>(m, (*fi).V(k))] + 1;<span class="comment">//index of vertex per face</span>
<a name="l00245"></a>00245 
<a name="l00246"></a>00246                     <span class="keywordtype">int</span> vt = -1;
<a name="l00247"></a>00247                     <span class="keywordflow">if</span>(mask &amp; Mask::IOM_WEDGTEXCOORD)
<a name="l00248"></a>00248                         vt = <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#af596133d6a8665874531ad66cf0e4ed5">GetIndexVertexTexture</a>(CoordIndexTexture,(*fi).WT(k));<span class="comment">//index of vertex texture per face</span>
<a name="l00249"></a>00249           <span class="keywordflow">if</span> (mask &amp; Mask::IOM_VERTTEXCOORD)
<a name="l00250"></a>00250             vt = vInd;
<a name="l00251"></a>00251 
<a name="l00252"></a>00252                     <span class="keywordtype">int</span> vn = -1;
<a name="l00253"></a>00253           <span class="keywordflow">if</span>(mask &amp; Mask::IOM_WEDGNORMAL )
<a name="l00254"></a>00254                         vn = <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a9714e572c902f73bf05e1ddf07071d40">GetIndexVertexNormal</a>(m, NormalVertex, (*fi).V(k)-&gt;cN());<span class="comment">//index of vertex normal per face.</span>
<a name="l00255"></a>00255           <span class="keywordflow">if</span> (mask &amp; Mask::IOM_VERTNORMAL)
<a name="l00256"></a>00256             vn = vInd;
<a name="l00257"></a>00257 
<a name="l00258"></a>00258                     <span class="comment">//writes elements on file obj</span>
<a name="l00259"></a>00259                     <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#ad13dbb14a7bd3dac80d21834a7c76a31">WriteFacesElement</a>(fp,vInd,vt,vn);
<a name="l00260"></a>00260                 }
<a name="l00261"></a>00261                 fprintf(fp,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00262"></a>00262             <span class="keywordflow">if</span> (cb !=NULL) {
<a name="l00263"></a>00263           <span class="keywordflow">if</span>(!(*cb)((100*++current)/totalPrimitives, <span class="stringliteral">&quot;writing vertices &quot;</span>))
<a name="l00264"></a>00264               { fclose(fp); <span class="keywordflow">return</span> <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fa0d6f0738ecd6056275f2deef0ede5b31">E_ABORTED</a>;}
<a name="l00265"></a>00265         }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267             }<span class="comment">//for</span>
<a name="l00268"></a>00268             fprintf(fp,<span class="stringliteral">&quot;# %d faces, %d coords texture\n\n&quot;</span>,m.fn,<span class="keywordtype">int</span>(CoordIndexTexture.size()));
<a name="l00269"></a>00269 
<a name="l00270"></a>00270             fprintf(fp,<span class="stringliteral">&quot;# End of File&quot;</span>);
<a name="l00271"></a>00271             fclose(fp);
<a name="l00272"></a>00272 
<a name="l00273"></a>00273             <span class="keywordtype">int</span> r = 0;
<a name="l00274"></a>00274             <span class="keywordflow">if</span>((mask &amp; Mask::IOM_WEDGTEXCOORD) || (mask &amp; Mask::IOM_FACECOLOR) )
<a name="l00275"></a>00275                 r = <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a4efb6248706daccae453252de92aa168">WriteMaterials</a>(materialVec, filename,cb);<span class="comment">//write material</span>
<a name="l00276"></a>00276 
<a name="l00277"></a>00277             <span class="keywordflow">if</span>(r!= <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fa6a1b7d8fde2edc6d0bb520f1f3a855e0">E_NOERROR</a>)
<a name="l00278"></a>00278                 <span class="keywordflow">return</span> r;
<a name="l00279"></a>00279             <span class="keywordflow">return</span> <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fa6a1b7d8fde2edc6d0bb520f1f3a855e0">E_NOERROR</a>;
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281 
<a name="l00282"></a>00282         <span class="comment">/*</span>
<a name="l00283"></a>00283 <span class="comment">            returns index of the vertex</span>
<a name="l00284"></a>00284 <span class="comment">        */</span>
<a name="l00285"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#ac744bf0192152d2bc55724601c975ebb">00285</a>         <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#ac744bf0192152d2bc55724601c975ebb">GetIndexVertex</a>(SaveMeshType &amp;m, <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a4264198f2d1ae395a3d5f8a71839a69a">VertexType</a> *p)
<a name="l00286"></a>00286         {
<a name="l00287"></a>00287             <span class="keywordflow">return</span> p-&amp;*(m.vert.begin());
<a name="l00288"></a>00288         }
<a name="l00289"></a>00289 
<a name="l00290"></a>00290         <span class="comment">/*</span>
<a name="l00291"></a>00291 <span class="comment">            returns index of the texture coord</span>
<a name="l00292"></a>00292 <span class="comment">        */</span>
<a name="l00293"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#af596133d6a8665874531ad66cf0e4ed5">00293</a>         <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#af596133d6a8665874531ad66cf0e4ed5">GetIndexVertexTexture</a>(std::map&lt;TexCoord2&lt;float&gt;,<span class="keywordtype">int</span>&gt; &amp;mapTexToInt, <span class="keyword">const</span> vcg::TexCoord2&lt;float&gt; &amp;wt)
<a name="l00294"></a>00294         {
<a name="l00295"></a>00295             std::map&lt;vcg::TexCoord2&lt;float&gt;,<span class="keywordtype">int</span>&gt;::iterator iter= mapTexToInt.find(wt);
<a name="l00296"></a>00296             <span class="keywordflow">if</span>(iter != mapTexToInt.end()) <span class="keywordflow">return</span> (*iter).second;
<a name="l00297"></a>00297             <span class="keywordflow">else</span>        <span class="keywordflow">return</span> -1;
<a name="l00298"></a>00298             <span class="comment">// Old wrong version.</span>
<a name="l00299"></a>00299             <span class="comment">// int index = mapTexToInt[wt];</span>
<a name="l00300"></a>00300             <span class="comment">// if(index!=0){return index;}</span>
<a name="l00301"></a>00301         }
<a name="l00302"></a>00302 
<a name="l00303"></a>00303         <span class="comment">/*</span>
<a name="l00304"></a>00304 <span class="comment">            returns index of the vertex normal</span>
<a name="l00305"></a>00305 <span class="comment">        */</span>
<a name="l00306"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a9714e572c902f73bf05e1ddf07071d40">00306</a>         <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a9714e572c902f73bf05e1ddf07071d40">GetIndexVertexNormal</a>(SaveMeshType &amp;<span class="comment">/*m*/</span>, std::map&lt;Point3d,int&gt; &amp;mapNormToInt, <span class="keyword">const</span> Point3d &amp;norm )
<a name="l00307"></a>00307         {
<a name="l00308"></a>00308           std::map&lt;Point3d,int&gt;::iterator iter= mapNormToInt.find(norm);
<a name="l00309"></a>00309             <span class="keywordflow">if</span>(iter != mapNormToInt.end()) <span class="keywordflow">return</span> (*iter).second;
<a name="l00310"></a>00310             <span class="keywordflow">else</span>        <span class="keywordflow">return</span> -1;
<a name="l00311"></a>00311             <span class="comment">// Old wrong version.</span>
<a name="l00312"></a>00312             <span class="comment">// int index = mapNormToInt[m.vert[iv].N()];</span>
<a name="l00313"></a>00313             <span class="comment">// if(index!=0){return index;}</span>
<a name="l00314"></a>00314         }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316         <span class="comment">/*</span>
<a name="l00317"></a>00317 <span class="comment">            write elements on file</span>
<a name="l00318"></a>00318 <span class="comment"></span>
<a name="l00319"></a>00319 <span class="comment">                f v/tc/vn v/tc/vn v/tc/vn ...</span>
<a name="l00320"></a>00320 <span class="comment">                f v/tc v/tc v/tc ...</span>
<a name="l00321"></a>00321 <span class="comment">                f v//vn v//vn v//vn ...</span>
<a name="l00322"></a>00322 <span class="comment">                f v v v ...</span>
<a name="l00323"></a>00323 <span class="comment"></span>
<a name="l00324"></a>00324 <span class="comment">        */</span>
<a name="l00325"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#ad13dbb14a7bd3dac80d21834a7c76a31">00325</a>         <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#ad13dbb14a7bd3dac80d21834a7c76a31">WriteFacesElement</a>(FILE *fp,<span class="keywordtype">int</span> v,<span class="keywordtype">int</span> vt, <span class="keywordtype">int</span> vn)
<a name="l00326"></a>00326         {
<a name="l00327"></a>00327             fprintf(fp,<span class="stringliteral">&quot;%d&quot;</span>,v);
<a name="l00328"></a>00328             <span class="keywordflow">if</span>(vt!=-1)
<a name="l00329"></a>00329             {
<a name="l00330"></a>00330                 fprintf(fp,<span class="stringliteral">&quot;/%d&quot;</span>,vt);
<a name="l00331"></a>00331                 <span class="keywordflow">if</span>(vn!=-1)
<a name="l00332"></a>00332                     fprintf(fp,<span class="stringliteral">&quot;/%d&quot;</span>,vn);
<a name="l00333"></a>00333             }
<a name="l00334"></a>00334             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(vn!=-1)
<a name="l00335"></a>00335                 fprintf(fp,<span class="stringliteral">&quot;//%d&quot;</span>,vn);
<a name="l00336"></a>00336         }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338         <span class="comment">/*</span>
<a name="l00339"></a>00339 <span class="comment">            adds a new index to the coordinate of Texture if it is the first time</span>
<a name="l00340"></a>00340 <span class="comment">            which is otherwise met not execute anything</span>
<a name="l00341"></a>00341 <span class="comment">        */</span>
<a name="l00342"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a2cd44837c6811ae1540718d484aabbfa">00342</a>         <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a2cd44837c6811ae1540718d484aabbfa">AddNewTextureCoord</a>(std::map&lt;vcg::TexCoord2&lt;float&gt;,<span class="keywordtype">int</span>&gt; &amp;m, <span class="keyword">const</span> vcg::TexCoord2&lt;float&gt; &amp;wt,<span class="keywordtype">int</span> value)
<a name="l00343"></a>00343         {
<a name="l00344"></a>00344             <span class="keywordtype">int</span> index = m[wt];
<a name="l00345"></a>00345             <span class="keywordflow">if</span>(index==0){m[wt]=value;<span class="keywordflow">return</span> <span class="keyword">true</span>;}
<a name="l00346"></a>00346             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00347"></a>00347         }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349         <span class="comment">/*</span>
<a name="l00350"></a>00350 <span class="comment">            adds a new index to the normal per vertex if it is the first time</span>
<a name="l00351"></a>00351 <span class="comment">            which is otherwise met does not execute anything</span>
<a name="l00352"></a>00352 <span class="comment">        */</span>
<a name="l00353"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a221ab806617b6eee77ecd69ec4b0ab75">00353</a>         <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a221ab806617b6eee77ecd69ec4b0ab75">AddNewNormalVertex</a>(std::map&lt;Point3d,int&gt; &amp;m, Point3d &amp;n ,<span class="keywordtype">int</span> value)
<a name="l00354"></a>00354         {
<a name="l00355"></a>00355             <span class="keywordtype">int</span> index = m[n];
<a name="l00356"></a>00356             <span class="keywordflow">if</span>(index==0){m[n]=value;<span class="keywordflow">return</span> <span class="keyword">true</span>;}
<a name="l00357"></a>00357             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00358"></a>00358         }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360         <span class="comment">/*</span>
<a name="l00361"></a>00361 <span class="comment">            writes material into file</span>
<a name="l00362"></a>00362 <span class="comment">        */</span>
<a name="l00363"></a><a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a4efb6248706daccae453252de92aa168">00363</a>         <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a4efb6248706daccae453252de92aa168">WriteMaterials</a>(std::vector&lt;Material&gt; &amp;materialVec, <span class="keyword">const</span> <span class="keywordtype">char</span> * filename, CallBackPos *cb=0)
<a name="l00364"></a>00364         {
<a name="l00365"></a>00365             std::string fileName = std::string(filename);
<a name="l00366"></a>00366             fileName+=<span class="stringliteral">&quot;.mtl&quot;</span>;
<a name="l00367"></a>00367 
<a name="l00368"></a>00368             <span class="keywordflow">if</span>(materialVec.size() &gt; 0)
<a name="l00369"></a>00369             {
<a name="l00370"></a>00370                 FILE *fp;
<a name="l00371"></a>00371                 fp = fopen(fileName.c_str(),<span class="stringliteral">&quot;w&quot;</span>);
<a name="l00372"></a>00372                 <span class="keywordflow">if</span>(fp==NULL)<span class="keywordflow">return</span> <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fa0d6f0738ecd6056275f2deef0ede5b31">E_ABORTED</a>;
<a name="l00373"></a>00373 
<a name="l00374"></a>00374                 fprintf(fp,<span class="stringliteral">&quot;#\n# Wavefront material file\n# Converted by Meshlab Group\n#\n\n&quot;</span>);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376                 <span class="keywordtype">int</span> current = 0;
<a name="l00377"></a>00377 
<a name="l00378"></a>00378                 <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;materialVec.size();i++)
<a name="l00379"></a>00379                 {
<a name="l00380"></a>00380                     <span class="keywordflow">if</span> (cb !=NULL)
<a name="l00381"></a>00381                         (*cb)((100 * ++current)/materialVec.size(), <span class="stringliteral">&quot;saving material file &quot;</span>);
<a name="l00382"></a>00382                     <span class="keywordflow">else</span>
<a name="l00383"></a>00383                     { <span class="comment">/* fclose(fp); return E_ABORTED; */</span> }
<a name="l00384"></a>00384 
<a name="l00385"></a>00385                     fprintf(fp,<span class="stringliteral">&quot;newmtl material_%d\n&quot;</span>,materialVec[i].index);
<a name="l00386"></a>00386                     fprintf(fp,<span class="stringliteral">&quot;Ka %f %f %f\n&quot;</span>,materialVec[i].Ka[0],materialVec[i].Ka[1],materialVec[i].Ka[2]);
<a name="l00387"></a>00387                     fprintf(fp,<span class="stringliteral">&quot;Kd %f %f %f\n&quot;</span>,materialVec[i].Kd[0],materialVec[i].Kd[1],materialVec[i].Kd[2]);
<a name="l00388"></a>00388                     fprintf(fp,<span class="stringliteral">&quot;Ks %f %f %f\n&quot;</span>,materialVec[i].Ks[0],materialVec[i].Ks[1],materialVec[i].Ks[2]);
<a name="l00389"></a>00389                     fprintf(fp,<span class="stringliteral">&quot;Tr %f\n&quot;</span>,materialVec[i].Tr);
<a name="l00390"></a>00390                     fprintf(fp,<span class="stringliteral">&quot;illum %d\n&quot;</span>,materialVec[i].illum);
<a name="l00391"></a>00391                     fprintf(fp,<span class="stringliteral">&quot;Ns %f\n&quot;</span>,materialVec[i].Ns);
<a name="l00392"></a>00392 
<a name="l00393"></a>00393                     <span class="keywordflow">if</span>(materialVec[i].map_Kd.size()&gt;0)
<a name="l00394"></a>00394                         fprintf(fp,<span class="stringliteral">&quot;map_Kd %s\n&quot;</span>,materialVec[i].map_Kd.c_str());
<a name="l00395"></a>00395                     fprintf(fp,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00396"></a>00396                 }
<a name="l00397"></a>00397                 fclose(fp);
<a name="l00398"></a>00398             }
<a name="l00399"></a>00399             <span class="keywordflow">return</span> <a class="code" href="classvcg_1_1tri_1_1io_1_1_exporter_o_b_j___point3d.html#a94e63c810e62afb889679fb7ea7a001fa6a1b7d8fde2edc6d0bb520f1f3a855e0">E_NOERROR</a>;
<a name="l00400"></a>00400         }
<a name="l00401"></a>00401 
<a name="l00402"></a>00402     }; <span class="comment">// end class</span>
<a name="l00403"></a>00403 } <span class="comment">// end Namespace tri</span>
<a name="l00404"></a>00404 } <span class="comment">// end Namespace io</span>
<a name="l00405"></a>00405 } <span class="comment">// end Namespace vcg</span>
<a name="l00406"></a>00406 
<a name="l00407"></a>00407 <span class="preprocessor">#endif</span>
</pre></div></div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Jun 29 2011 16:17:36 for fg by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
